import{Peer as V}from"https://esm.sh/peerjs@1.5.2?bundle-deps";import{initializeApp as k}from"https://www.gstatic.com/firebasejs/9.6.2/firebase-app.js";import{getFirestore as T,doc as g,onSnapshot as R,updateDoc as B,addDoc as M,collection as A,getDoc as S}from"https://www.gstatic.com/firebasejs/9.6.2/firebase-firestore.js";import{getAuth as W,signInAnonymously as j}from"https://www.gstatic.com/firebasejs/9.6.2/firebase-auth.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}})();const x={apiKey:"AIzaSyDnIZ0IfeQ8VwQFyXFLMfrRsoqS_WC_ht4",authDomain:"real-call.firebaseapp.com",projectId:"real-call",storageBucket:"real-call.appspot.com",messagingSenderId:"64872948580",appId:"1:64872948580:web:789f18dfab9e2abb58d071",measurementId:"G-GXE40EG2GL"},D=k(x),u=T(),m="signals",F=async()=>{const o=await f(),t=(await M(A(u,m),{callerId:o.uid,localId:null,remoteId:null,calleeId:null})).id;return document.location.href+"?room="+t},P=(o,r)=>{const t=g(u,m,o);return R(t,r)},w=async o=>await S(g(u,m,o)),U=async(o,r=null)=>{const t=await f();await B(g(u,m,o),{remoteId:r,calleeId:t.uid})},G=async(o,r)=>await B(g(u,m,o),{localId:r}),f=async()=>{const o=W(D);try{return(await j(o)).user}catch(r){throw console.error("Anonymous authentication failed:",r.message),r}},l=new URLSearchParams(document.location.search).get("room"),I=document.getElementById("muteButton"),b=document.getElementById("videoButton"),y=document.getElementById("createLink"),h=document.getElementById("sdpOfferLink"),E=document.getElementById("copy"),L=document.getElementById("menu"),N=document.getElementById("dashboard"),q=document.getElementById("controls"),z=document.getElementById("app"),H=document.getElementById("closeChat");async function K(){y.innerText="Creating...",console.log("creating Room link");const o=await F();h.value=o,y.innerText="Create Chat Link"}function p(o,r=2,t="black"){var a=document.getElementById("infoMsg");a.style.backgroundColor=t,clearTimeout(),a.innerText="",a.innerText=o,a.classList.remove("hidden"),setTimeout(function(){a.classList.add("hidden"),a.innerText=""},1e3*r)}if(l){let r=function(){return new Promise(async(t,a)=>{try{const e=await f(),n=await w(l);t(n.data())}catch(e){a(e)}})};L.classList.add("hidden"),q.classList.remove("hidden"),z.classList.remove("hidden");async function o(){const a=await(await f()).uid;return await(await w(l)).data().callerId===a}navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(t=>{const a=document.getElementById("localVideo");a.srcObject=t;let e=!1;I.addEventListener("click",()=>{e=!e,t.getAudioTracks().forEach(c=>{c.enabled=!e}),I.innerHTML=e?'<i class="fa-solid fa-microphone-slash"></i>':'<i class="fa-solid fa-microphone"></i>'});let n=!1;b.addEventListener("click",()=>{n=!n,t.getVideoTracks().forEach(c=>{c.enabled=!n}),b.innerHTML=n?'<i class="fa-solid fa-video-slash"></i>':'<i class="fa-solid fa-video"></i>'}),H.addEventListener("click",()=>{s.destroy(),a.srcObject.getTracks().forEach(i=>i.stop());const c=document.getElementById("remoteVideo");c.srcObject&&c.srcObject.getTracks().forEach(i=>i.stop()),window.location.replace(window.location.origin+window.location.pathname)});const s=new V({host:"peerjs-server-tq94.onrender.com",port:80,path:"/peerjs/server",secure:!0,config:{iceServers:[{urls:"stun:stun.relay.metered.ca:80"},{urls:"turn:standard.relay.metered.ca:80",username:"e437f719844bbfd0946a0ee1",credential:"yOVlFtWtndW0oeen"},{urls:"turn:standard.relay.metered.ca:80?transport=tcp",username:"e437f719844bbfd0946a0ee1",credential:"yOVlFtWtndW0oeen"},{urls:"turn:standard.relay.metered.ca:443",username:"e437f719844bbfd0946a0ee1",credential:"yOVlFtWtndW0oeen"},{urls:"turn:standard.relay.metered.ca:443?transport=tcp",username:"e437f719844bbfd0946a0ee1",credential:"yOVlFtWtndW0oeen"}]}});s.on("open",async c=>{p("Waiting for Remote Peer connection...",100),await o()?(console.log("My peer ID is: "+c),await G(l,c)):await U(l,c),v()}),s.on("call",c=>{c.answer(t),p("Connection established!",2,"green"),c.on("stream",i=>{const d=document.getElementById("remoteVideo");d.srcObject=i})});async function v(){await r();async function c(i){try{if(i.exists()){let d=await i.data().remoteId;d&&await o()&&s.call(d,t).on("stream",O=>{const C=document.getElementById("remoteVideo");C.srcObject=O,p("Connection established!",2,"green")})}else window.location.replace(window.location.origin+window.location.pathname)}catch(d){console.log(d.message)}}P(l,c)}}).catch(t=>{console.error("Error accessing media devices:",t)})}else y.onclick=K,L.onclick=()=>{N.classList.toggle("hidden")},E.onclick=()=>{h.select(),h.setSelectionRange(0,99999),document.execCommand("copy"),E.innerText="Copied"},console.log("Room not exist");
