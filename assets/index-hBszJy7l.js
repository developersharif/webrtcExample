import{Peer as O}from"https://esm.sh/peerjs@1.5.2?bundle-deps";import{initializeApp as T}from"https://www.gstatic.com/firebasejs/9.6.2/firebase-app.js";import{getFirestore as R,doc as g,onSnapshot as M,updateDoc as B,addDoc as V,collection as A,getDoc as S}from"https://www.gstatic.com/firebasejs/9.6.2/firebase-firestore.js";import{getAuth as x,signInAnonymously as D}from"https://www.gstatic.com/firebasejs/9.6.2/firebase-auth.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}})();const P={apiKey:"AIzaSyDnIZ0IfeQ8VwQFyXFLMfrRsoqS_WC_ht4",authDomain:"real-call.firebaseapp.com",projectId:"real-call",storageBucket:"real-call.appspot.com",messagingSenderId:"64872948580",appId:"1:64872948580:web:789f18dfab9e2abb58d071",measurementId:"G-GXE40EG2GL"},U=T(P),u=R(),m="signals",j=async()=>{const o=await f(),t=(await V(A(u,m),{callerId:o.uid,localId:null,remoteId:null,calleeId:null})).id;return document.location.href+"?room="+t},G=(o,c)=>{const t=g(u,m,o);return M(t,c)},w=async o=>await S(g(u,m,o)),F=async(o,c=null)=>{const t=await f();await B(g(u,m,o),{remoteId:c,calleeId:t.uid})},N=async(o,c)=>await B(g(u,m,o),{localId:c}),f=async()=>{const o=x(U);try{return(await D(o)).user}catch(c){throw console.error("Anonymous authentication failed:",c.message),c}},l=new URLSearchParams(document.location.search).get("room"),I=document.getElementById("muteButton"),E=document.getElementById("videoButton"),y=document.getElementById("createLink"),h=document.getElementById("sdpOfferLink"),L=document.getElementById("copy"),b=document.getElementById("menu"),q=document.getElementById("dashboard"),z=document.getElementById("controls"),H=document.getElementById("app"),K=document.getElementById("closeChat");async function Q(){y.innerText="Creating...",console.log("creating Room link");const o=await j();h.value=o,y.innerText="Create Chat Link"}function p(o,c=2,t="black"){var a=document.getElementById("infoMsg");a.style.backgroundColor=t,clearTimeout(),a.innerText="",a.innerText=o,a.classList.remove("hidden"),setTimeout(function(){a.classList.add("hidden"),a.innerText=""},1e3*c)}if(l){let c=function(){return new Promise(async(t,a)=>{try{const e=await f(),n=await w(l);t(n.data())}catch(e){a(e)}})};b.classList.add("hidden"),z.classList.remove("hidden"),H.classList.remove("hidden");async function o(){const a=await(await f()).uid;return await(await w(l)).data().callerId===a}navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(t=>{const a=document.getElementById("localVideo");a.srcObject=t;let e=!1;I.addEventListener("click",()=>{e=!e,t.getAudioTracks().forEach(i=>{i.enabled=!e}),I.innerHTML=e?'<i class="fa-solid fa-microphone-slash"></i>':'<i class="fa-solid fa-microphone"></i>'});let n=!1;E.addEventListener("click",()=>{n=!n,t.getVideoTracks().forEach(i=>{i.enabled=!n}),E.innerHTML=n?'<i class="fa-solid fa-video-slash"></i>':'<i class="fa-solid fa-video"></i>'}),K.addEventListener("click",()=>{s.destroy(),a.srcObject.getTracks().forEach(r=>r.stop());const i=document.getElementById("remoteVideo");i.srcObject&&i.srcObject.getTracks().forEach(r=>r.stop()),window.location.replace(window.location.origin+window.location.pathname)});const s=new O;s.on("open",async i=>{p("Waiting for Remote Peer connection...",100),await o()?(console.log("My peer ID is: "+i),await N(l,i)):await F(l,i),v()}),s.on("call",i=>{i.answer(t),p("Connection established!",2,"green"),i.on("stream",r=>{const d=document.getElementById("remoteVideo");d.srcObject=r})});async function v(){await c();async function i(r){try{if(r.exists()){let d=await r.data().remoteId;d&&await o()&&s.call(d,t).on("stream",C=>{const k=document.getElementById("remoteVideo");k.srcObject=C,p("Connection established!",2,"green")})}else window.location.replace(window.location.origin+window.location.pathname)}catch(d){console.log(d.message)}}G(l,i)}}).catch(t=>{console.error("Error accessing media devices:",t)})}else y.onclick=Q,b.onclick=()=>{q.classList.toggle("hidden")},L.onclick=()=>{h.select(),h.setSelectionRange(0,99999),document.execCommand("copy"),L.innerText="Copied"},console.log("Room not exist");
