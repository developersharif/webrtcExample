import{Peer as V}from"https://esm.sh/peerjs@1.5.2?bundle-deps";import{initializeApp as k}from"https://www.gstatic.com/firebasejs/9.6.2/firebase-app.js";import{getFirestore as T,doc as g,onSnapshot as R,updateDoc as B,addDoc as M,collection as S,getDoc as A}from"https://www.gstatic.com/firebasejs/9.6.2/firebase-firestore.js";import{getAuth as W,signInAnonymously as x}from"https://www.gstatic.com/firebasejs/9.6.2/firebase-auth.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}})();const D={apiKey:"AIzaSyDnIZ0IfeQ8VwQFyXFLMfrRsoqS_WC_ht4",authDomain:"real-call.firebaseapp.com",projectId:"real-call",storageBucket:"real-call.appspot.com",messagingSenderId:"64872948580",appId:"1:64872948580:web:789f18dfab9e2abb58d071",measurementId:"G-GXE40EG2GL"},F=k(D),u=T(),m="signals",P=async()=>{const o=await f(),t=(await M(S(u,m),{callerId:o.uid,localId:null,remoteId:null,calleeId:null})).id;return document.location.href+"?room="+t},U=(o,a)=>{const t=g(u,m,o);return R(t,a)},w=async o=>await A(g(u,m,o)),j=async(o,a=null)=>{const t=await f();await B(g(u,m,o),{remoteId:a,calleeId:t.uid})},G=async(o,a)=>await B(g(u,m,o),{localId:a}),f=async()=>{const o=W(F);try{return(await x(o)).user}catch(a){throw console.error("Anonymous authentication failed:",a.message),a}},l=new URLSearchParams(document.location.search).get("room"),I=document.getElementById("muteButton"),b=document.getElementById("videoButton"),y=document.getElementById("createLink"),h=document.getElementById("sdpOfferLink"),E=document.getElementById("copy"),L=document.getElementById("menu"),N=document.getElementById("dashboard"),q=document.getElementById("controls"),z=document.getElementById("app"),H=document.getElementById("closeChat");async function K(){y.innerText="Creating...",console.log("creating Room link");const o=await P();h.value=o,y.innerText="Create Chat Link"}function p(o,a=2,t="black"){var c=document.getElementById("infoMsg");c.style.backgroundColor=t,clearTimeout(),c.innerText="",c.innerText=o,c.classList.remove("hidden"),setTimeout(function(){c.classList.add("hidden"),c.innerText=""},1e3*a)}if(l){let a=function(){return new Promise(async(t,c)=>{try{const e=await f(),n=await w(l);t(n.data())}catch(e){c(e)}})};L.classList.add("hidden"),q.classList.remove("hidden"),z.classList.remove("hidden");async function o(){const c=await(await f()).uid;return await(await w(l)).data().callerId===c}navigator.mediaDevices.getUserMedia({video:!0,audio:{noiseSuppression:!0,echoCancellation:!0}}).then(t=>{const c=document.getElementById("localVideo");c.srcObject=t;let e=!1;I.addEventListener("click",()=>{e=!e,t.getAudioTracks().forEach(r=>{r.enabled=!e}),I.innerHTML=e?'<i class="fa-solid fa-microphone-slash"></i>':'<i class="fa-solid fa-microphone"></i>'});let n=!1;b.addEventListener("click",()=>{n=!n,t.getVideoTracks().forEach(r=>{r.enabled=!n}),b.innerHTML=n?'<i class="fa-solid fa-video-slash"></i>':'<i class="fa-solid fa-video"></i>'}),H.addEventListener("click",()=>{s.destroy(),c.srcObject.getTracks().forEach(i=>i.stop());const r=document.getElementById("remoteVideo");r.srcObject&&r.srcObject.getTracks().forEach(i=>i.stop()),window.location.replace(window.location.origin+window.location.pathname)});const s=new V({config:{iceServers:[{urls:"stun:stun.relay.metered.ca:80"},{urls:"turn:standard.relay.metered.ca:80",username:"e437f719844bbfd0946a0ee1",credential:"yOVlFtWtndW0oeen"},{urls:"turn:standard.relay.metered.ca:80?transport=tcp",username:"e437f719844bbfd0946a0ee1",credential:"yOVlFtWtndW0oeen"},{urls:"turn:standard.relay.metered.ca:443",username:"e437f719844bbfd0946a0ee1",credential:"yOVlFtWtndW0oeen"},{urls:"turn:standard.relay.metered.ca:443?transport=tcp",username:"e437f719844bbfd0946a0ee1",credential:"yOVlFtWtndW0oeen"}]},debug:1});s.on("open",async r=>{p("Waiting for Remote Peer connection...",100),await o()?(console.log("My peer ID is: "+r),await G(l,r)):await j(l,r),v()}),s.on("call",r=>{r.answer(t),p("Connection established!",2,"green"),r.on("stream",i=>{const d=document.getElementById("remoteVideo");d.srcObject=i})});async function v(){await a();async function r(i){try{if(i.exists()){let d=await i.data().remoteId;d&&await o()&&s.call(d,t).on("stream",C=>{const O=document.getElementById("remoteVideo");O.srcObject=C,p("Connection established!",2,"green")})}else window.location.replace(window.location.origin+window.location.pathname)}catch(d){console.log(d.message)}}U(l,r)}}).catch(t=>{console.error("Error accessing media devices:",t)})}else y.onclick=K,L.onclick=()=>{N.classList.toggle("hidden")},E.onclick=()=>{h.select(),h.setSelectionRange(0,99999),document.execCommand("copy"),E.innerText="Copied"},console.log("Room not exist");
